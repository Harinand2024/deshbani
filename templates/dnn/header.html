{% load i18n %}
{% load static %}

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<style>
  /* ðŸŒ DXBINDIA HEADER + SIDEBAR */
  :root {
    --dxb-bg: #ffffff;
    --dxb-text: #000000;
    --dxb-border: #e6e6e6;
    --dxb-hover: #f7f7f7;
  }

  body.dark-mode {
    --dxb-bg: #121212;
    --dxb-text: #f5f5f5;
    --dxb-border: #2a2a2a;
    --dxb-hover: #1e1e1e;
    background: var(--dxb-bg);
    color: var(--dxb-text);
  }
.card-bg-dark {
    background: var(--dxb-bg) !important;
    padding: 10px;
}
.card-bg-dark i{opacity: 0.5;}
  /* HEADER */
  .dxbindia-header {
    
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    top: 0;
    z-index: 1050;
    transition: background 0.3s ease;
    padding: 6px 0px;
  }

  .dxbindia-header .search-box {
    flex: 1 1 300px;
    margin: 10px 20px;
    position: relative;
  }

  .dxbindia-header .search-box input {
    width: 100%;
    padding: 8px 35px;
    border-radius: 20px;
    border: 1px solid var(--dxb-border);
    background: var(--dxb-bg);
    color: var(--dxb-text);
  }

  .dxbindia-header .search-box i {
    position: absolute;
    top: 50%;
    left: 10px;
    transform: translateY(-50%);
    color: #777;
  }
 .suggestion-item {
    padding: 10px 15px;
    cursor: pointer;
  }
  .suggestion-item:hover {
    background-color: #f8f9fa;
  }
  .recent-header {
    font-size: 13px;
    color: #777;
    padding: 5px 15px 0;
    text-transform: uppercase;
  }
  /* TOP NAVIGATION */
  .dxbindia-topnav {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    justify-content: start;
    width: 100%;
    padding: 8px 0 ;
    margin-top: 6px;
  }

  .dxbindia-topnav > .dxbindia-dropdown {
    position: relative;
  }

  .dxbindia-topnav a {
    color: var(--dxb-text);
    text-decoration: none;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
  }

  .dxbindia-topnav a:hover {
    background: var(--dxb-hover);
    color: #0078d4;
  }

  /* CUSTOM DROPDOWN MENU */
  .dxbindia-dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: var(--dxb-bg);
    border: 1px solid var(--dxb-border);
    border-radius: 10px;
    min-width: 180px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    z-index: 1100;
  }

  .dxbindia-dropdown-menu a {
    display: block;
    padding: 8px 15px;
    color: var(--dxb-text);
    text-decoration: none;
    border-radius: 0;
  }

  .dxbindia-dropdown-menu a:hover {
    background: var(--dxb-hover);
    color: #0078d4;
  }

  .dxbindia-dropdown.show .dxbindia-dropdown-menu {
    display: block;
  }

  /* SIDEBAR */
  .dxbindia-sidebar {
    position: fixed;
    top: 0;
    left: -280px;
    width: 280px;
    height: 100%;
    background: var(--dxb-bg);
    border-right: 1px solid var(--dxb-border);
    transition: left 0.3s ease;
    padding: 20px;
    z-index: 1200;
    overflow-y: auto;
  }

  .dxbindia-sidebar.active {
    left: 0;
  }

  .dxbindia-sidebar .nav-link {
    display: flex;
    align-items: center;
    padding: 10px;
    color: var(--dxb-text);
    border-radius: 8px;
  }

  .dxbindia-sidebar .submenu {
    padding-left: 30px;
  }

  .dxbindia-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    display: none;
    z-index: 1150;
  }

  .dxbindia-overlay.active {
    display: block;
  }

  /* Dark Mode Toggle */
  .dxbindia-toggle {
    border: 1px solid var(--dxb-border);
    border-radius: 20px;
    padding: 4px 12px;
    cursor: pointer;
    background: transparent;
    color: var(--dxb-text);
  }
.language-button-wrapper {
        position: relative;
        display: inline-block;
        background-color: #ddd;
        color: #000;
        padding: 6px 15px 2px;
        border-radius: 5px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        overflow: hidden;
        margin:10px;
    }
    #google_translate_element {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
    }

     #google_translate_element_sticky{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
    }

    #google_translate_element select {
        width: 100%;
        height: 100%;
        cursor: pointer;
    }
     #google_translate_element_sticky select {
        width: 100%;
        height: 100%;
        cursor: pointer;
    } 
  .language-button-wrapper img {
    height: 16px;
    width: 16px;
    color:white !important;
   }


  /* Hide ANY Google Translate banner iframe */

  .goog-te-banner-frame.skiptranslate {
      display: none !important;
  } 

  body {
      top: 0px !important;  /* reset body position */
  }
  /* Style the dropdown container */
.goog-te-combo {
  background-color: #ddd !important;
  color: white !important;
  border: 1px solid #444 !important;
  padding: 16px 0px !important;
  border-radius: 6px;
  font-family: Arial, sans-serif;
  width: 100% !important;
  margin: 0px !important;
}

/* Optional: Style the dropdown arrow */
.goog-te-combo option {
  background-color: black;
  color: white;
}

.login-btn {
    padding: 6px 15px;
    background: #ed1c24;
    color: white !important;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
    box-shadow: 0 0 0 transparent;
    margin: 0px;
  }

  .login-btn:hover {
    background: #a50b10 !important;
    color: white !important;
    box-shadow: none !important;
  }

  /* Smooth Modal Animation */
#ModalSearch .modal-dialog {
  transform: translateY(-30px);
  transition: all 0.3s ease-in-out;
}
#ModalSearch.show .modal-dialog {
  transform: translateY(0);
}

/* Custom Input Styling */
#ModalSearch .form-control::placeholder {
  color: #999;
  font-style: italic;
}

/* Search Icon */
#ModalSearch .input-group-text i {
  font-size: 1.2rem;
}

/* Responsive */
@media (max-width: 576px) {
  #ModalSearch .modal-dialog {
    margin: 0 10px;
  }
  #ModalSearch .modal-body form {
    max-width: 100%;
  }
}
  @media (max-width: 768px) {
    .dxbindia-topnav {
      flex-wrap: nowrap;
      overflow-x: auto;
      white-space: nowrap;
      padding-bottom: 8px;
    }
    .dxbindia-topnav a {
      flex: 0 0 auto;
    }
  }
</style>

<header class="dxbindia-header px-3">
  <!-- Left: Menu & Logo -->
    <div class="d-flex align-items-center gap-2">
     
    <a href="/" class="text-center">
        <img src="{{ profile_setting.logo_dark.url }}" alt="Dark Logo"
            class="logo logo-light logo " style="height: 36px;">
        <img src="{{ profile_setting.logo_light.url }}" alt="Light Logo"
            class="logo logo-dark logo " style="height: 36px;">
    </a>
    </div>

   <!-- Center: Search -->
    <div class="flex-grow-1 d-flex justify-content-center position-relative">
      <div class="search-box position-relative" style="max-width:700px; width:100%;">
        <i class="bi bi-search position-absolute" 
          style="left:15px; top:50%; transform:translateY(-50%); color:#777;"></i>

        <form action="{% url 'search' %}" method="get" class="w-100">
          <input type="text" id="searchBox" name="title"
                class="form-control ps-5 rounded-pill"
                placeholder="Search news, topics or categories..."
                autocomplete="off">
        </form>

        <!-- Suggestion + Recent List -->
        <div id="suggestionsBox"
            class="suggestions position-absolute w-100 card-bg-dark border rounded-3 shadow-sm d-none mt-1" style="z-index: 1050;"></div>
      </div>
    </div>

    <!-- Right: Icons -->
    <div class="d-flex align-items-center">
      <!-- Search Icon (mobile) -->
      <a class=" d-md-none" data-bs-toggle="modal" data-bs-target="#ModalSearch">
        <i class="bi bi-search fs-5"></i>
      </a>

      <!-- Notification -->
      <a class="" data-bs-toggle="modal" data-bs-target="#ModalSubscribe">
        <i class="bi bi-bell-fill fs-5 text-danger"></i>
      </a>
      {% include 'subscribe_model.html' %}

      <!-- Calendar -->
      <!-- Date -->
      <!-- <a href="#" class="d-flex align-items-center text-decoration-none">
        <i class="bi bi-calendar-date-fill me-2 fs-5"></i>
        <span class="calender-text" id="currentDate"></span>
      </a> -->
      <!-- Login / Logout -->
      <!-- {% if request.session.journalist_id %}
        <a href="{% url 'dashboard' %}" class=""><i class="bi bi-person-circle fs-5"></i></a>
      {% else %}
        <a href="{% url 'sign-in' %}" class=""><i class="bi bi-person-circle fs-5"></i></a>
      {% endif %} -->
      <!-- Language -->
       
      <div class="language-button-wrapper p-1 px-2">
        <i class="bi bi-translate fs-6"></i>
        <div id="google_translate_element"></div>
      </div>
      <a href="#" class="d-flex align-items-center text-decoration-none">
          <i class="bi bi-calendar-date-fill mr-2"></i>
          <span class="calender-text" id="currentDate"></span>
      </a>
      <!-- Dark Mode -->
      <button id="darkToggle" class="dxbindia-toggle mx-2" ><i class="bi bi-moon"></i> Dark</button>

    
    </div>
    
<div class="container">
  
  <!-- TOP NAV -->
  <!-- âœ… DXBINDIA Dynamic Navigation -->
    <div class="dxbindia-topnav">
       <button id="menuBtn" class="btn btn-light">
        <i class="bi bi-list"></i>
      </button>
      
      {% for link in Blogcat %}
      <div class="dxbindia-dropdown">
        <a href="#" class="dxbindia-dropdown-toggle">
          {% trans link.cat_name %}
        </a>

        {% if link.sub_category_set.all %}
        <div class="dxbindia-dropdown-menu">
          {% for sublink in link.sub_category_set.all|dictsort:"subcat_status" %}
            {% if sublink.subcat_status == 'active' %}
            <a href="/{{ link.cat_slug }}/{{ sublink.subcat_slug }}">
              {% trans sublink.subcat_name %}
            </a>
            {% endif %}
          {% endfor %}
        </div>
        {% endif %}
      </div>
      {% endfor %}

    </div>
</div>
</header>

<!-- SIDEBAR -->
<div class="dxbindia-sidebar" id="sidebar">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center">
     <a href="/" class="d-inline-block">
        <img src="{{ profile_setting.logo_dark.url }}" alt="Dark Logo" class="logo-light" style="max-height:36px;">
        <img src="{{ profile_setting.logo_light.url }}" alt="Light Logo" class="logo-dark" style="max-height:36px;">
      </a>
    </div>
    <button class="btn btn-light btn-sm" id="closeSidebar"><i class="bi bi-x-lg"></i></button>
  </div>

    <!-- âœ… DXBINDIA SIDEBAR MENU -->
    <ul class="nav flex-column" id="dxbindiaSidebarMenu">

      {% for link in Blogcat %}
      <li class="border-bottom mb-1 pb-1">
        <a href="#"
          class="nav-link dropdown-toggle"
          data-bs-toggle="collapse"
          data-bs-target="#menu{{ forloop.counter }}"
          aria-expanded="false">
          {{ link.cat_name }}
        </a>

        {% if link.sub_category_set.all %}
        <ul class="submenu collapse" id="menu{{ forloop.counter }}" data-bs-parent="#dxbindiaSidebarMenu">
          {% for sublink in link.sub_category_set.all|dictsort:"subcat_status" %}
            {% if sublink.subcat_status == 'active' %}
            <li>
              <a href="/{{ link.cat_slug }}/{{ sublink.subcat_slug }}" class="nav-link">
                {{ sublink.subcat_name }}
              </a>
            </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% endif %}
      </li>
      {% endfor %}

    </ul>


</div>
<!-- ðŸ” Search Modal -->
<div class="modal fade" id="ModalSearch" tabindex="-1" aria-labelledby="ModalSearchLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-lg rounded-4">

      <!-- Header -->
      <div class="modal-header border-0 pb-0 px-4 pt-4">
        <h5 class="modal-title fw-semibold " id="ModalSearchLabel">Search</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          style="width: 40px; height: 40px; background-color: transparent; border: none;">
        </button>
      </div>

      <!-- Body -->
      <div class="modal-body px-4 pb-4 pt-3">

        <form action="{% url 'search' %}" method="get" class="mx-auto" style="max-width: 600px;">
          <div class="input-group input-group-lg border rounded-pill shadow-sm overflow-hidden">
            <span class="input-group-text card-bg-dark border-0 ps-4">
              <i class="bi bi-search text-secondary"></i>
            </span>
            <input type="text" name="title" class="form-control border-0 shadow-none"
              placeholder="Search for posts, topics or categories..." required>
          </div>

          <button type="submit"
            class="btn w-100 mt-4 py-2 rounded-pill fw-semibold text-white"
            style="background-color: #ed1c24; border: none; font-size: 16px;">
            Search
          </button>
        </form>

      </div>
    </div>
  </div>
</div>

<div class="dxbindia-overlay" id="overlay"></div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<!-- Load Google Translate API -->
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
    window.addEventListener("scroll", function () {
        var stickyNav = document.getElementById("stickyNav");
        if (window.pageYOffset > 100) {
            stickyNav.style.display = "block";
        } else {
            stickyNav.style.display = "none";
        }
    });

    const getFormattedDate = () => {
        const options = { weekday: 'short', day: '2-digit', month: 'short', year: 'numeric' };
        const today = new Date();
        return today.toLocaleDateString('en-US', options);
    };
    document.getElementById('currentDate').innerText = getFormattedDate();
</script>
<script>
  const menuBtn = document.getElementById("menuBtn");
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("overlay");
  const closeSidebar = document.getElementById("closeSidebar");
  const darkToggle = document.getElementById("darkToggle");

  // Sidebar toggle
  menuBtn.addEventListener("click", () => {
    sidebar.classList.add("active");
    overlay.classList.add("active");
  });

  closeSidebar.addEventListener("click", () => {
    sidebar.classList.remove("active");
    overlay.classList.remove("active");
  });

  overlay.addEventListener("click", () => {
    sidebar.classList.remove("active");
    overlay.classList.remove("active");
  });

  // Dark mode toggle
  darkToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    darkToggle.innerHTML = document.body.classList.contains("dark-mode")
      ? '<i class="bi bi-sun"></i> Light'
      : '<i class="bi bi-moon"></i> Dark';
  });

  // âœ… Main Menu Dropdown Logic (Click toggle with auto-close)
document.querySelectorAll('.dxbindia-dropdown-toggle').forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    const parent = btn.parentElement;

    // Close all other open dropdowns first
    document.querySelectorAll('.dxbindia-dropdown.show').forEach(drop => {
      if (drop !== parent) drop.classList.remove('show');
    });

    // Toggle current dropdown
    parent.classList.toggle('show');
  });
});

// Close dropdown if clicked outside
document.addEventListener('click', () => {
  document.querySelectorAll('.dxbindia-dropdown.show').forEach(drop => drop.classList.remove('show'));
});

document.querySelectorAll('.dxbindia-sidebar .dropdown-toggle').forEach(toggle => {
    toggle.addEventListener('click', function (e) {
      const target = document.querySelector(this.dataset.bsTarget);

      // Close all other open submenus
      document.querySelectorAll('.dxbindia-sidebar .submenu.show').forEach(menu => {
        if (menu !== target) {
          const collapse = bootstrap.Collapse.getInstance(menu);
          if (collapse) collapse.hide();
        }
      });
    });
  });
</script>
<script>
  function applyCustomTranslateStyles() {
  const combo = document.querySelector('.goog-te-combo');
  if (combo) {
    combo.style.backgroundColor = 'black';
    combo.style.color = 'white';
    combo.style.border = '1px solid #444';
    combo.style.padding = '16px';
    combo.style.borderRadius = '6px';
  }
}

// Wait for the widget to load
setTimeout(applyCustomTranslateStyles, 1000);
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'en,hi,pa',
      layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL,
      autoDisplay: false
    }, 'google_translate_element');
  }

  function hideTranslateBanner() {
    const elements = document.querySelectorAll(".VIpgJd-ZVi9od-ORHb-OEVmcd.skiptranslate");
    elements.forEach(el => {
      el.style.display = "none";
    });
  }

  // Run once on load
  hideTranslateBanner();

  // Watch for future changes (Google injects banner after load)
  const observer = new MutationObserver(hideTranslateBanner);
  observer.observe(document.body, { childList: true, subtree: true });
</script>

<script>
  const searchBox = document.getElementById('searchBox');
  const suggestionsBox = document.getElementById('suggestionsBox');

  // Load from localStorage
  function getRecentSearches() {
    return JSON.parse(localStorage.getItem('recentSearches') || '[]');
  }

  function saveRecentSearch(query) {
    if (!query) return;
    let recents = getRecentSearches().filter(item => item.toLowerCase() !== query.toLowerCase());
    recents.unshift(query);
    if (recents.length > 5) recents = recents.slice(0, 5); // keep only 5 latest
    localStorage.setItem('recentSearches', JSON.stringify(recents));
  }

  function showRecentSearches() {
    const recents = getRecentSearches();
    if (recents.length > 0) {
      suggestionsBox.innerHTML = `
        <div class="recent-header">Recent Searches</div>
        ${recents.map(item => `<div class="suggestion-item" data-title="${item}">${item}
        </div>`).join('')}
      `;
      suggestionsBox.classList.remove('d-none');
    }
  }

  // When focused, show recent searches
  searchBox.addEventListener('focus', showRecentSearches);

  // Live suggestions (AJAX)
  searchBox.addEventListener('input', () => {
    const query = searchBox.value.trim();
    if (query.length < 2) {
      showRecentSearches();
      return;
    }

    fetch(`/search-suggestions/?q=${encodeURIComponent(query)}`)
      .then(response => response.json())
      .then(data => {
        const suggestions = data.suggestions || [];
        if (suggestions.length > 0) {
          suggestionsBox.innerHTML = suggestions
            .map(item => `<div class="suggestion-item" data-title="${item.title}">
              <i class="bi bi-search text-muted me-2"></i>${item.title}
            </div>`)
            .join('');
          suggestionsBox.classList.remove('d-none');
        } else {
          suggestionsBox.classList.add('d-none');
        }
      });
  });

  // Hide when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.search-box')) suggestionsBox.classList.add('d-none');
  });

  // Click suggestion or recent â†’ go to search page
  suggestionsBox.addEventListener('click', (e) => {
    const item = e.target.closest('.suggestion-item');
    if (item) {
      const title = item.getAttribute('data-title');
      saveRecentSearch(title);
      window.location.href = `{% url 'search' %}?title=${encodeURIComponent(title)}`;
    }
  });

  // Press Enter â†’ go to search + save
  searchBox.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      const query = searchBox.value.trim();
      if (query) {
        saveRecentSearch(query);
        window.location.href = `{% url 'search' %}?title=${encodeURIComponent(query)}`;
      }
    }
  });
</script>