{% load i18n %}
{% load static %}

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<style>
  /* ðŸŒ DXBINDIA HEADER + SIDEBAR */
  :root {
    --dxb-bg: #ffffff;
    --dxb-text: #000000;
    --dxb-border: #e6e6e6;
    --dxb-hover: #f7f7f7;
  }

  body.dark-mode {
    --dxb-bg: #121212;
    --dxb-text: #f5f5f5;
    --dxb-border: #2a2a2a;
    --dxb-hover: #1e1e1e;
    background: var(--dxb-bg);
    color: var(--dxb-text);
  }

  /* HEADER */
  .dxbindia-header {
    background: var(--dxb-bg);
    border-bottom: 1px solid var(--dxb-border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    position: sticky;
    top: 0;
    z-index: 1050;
    transition: background 0.3s ease;
    padding: 6px 0px;
  }

  .dxbindia-header .search-box {
    flex: 1 1 300px;
    margin: 10px 20px;
    position: relative;
  }

  .dxbindia-header .search-box input {
    width: 100%;
    padding: 8px 35px;
    border-radius: 20px;
    border: 1px solid var(--dxb-border);
    background: var(--dxb-bg);
    color: var(--dxb-text);
  }

  .dxbindia-header .search-box i {
    position: absolute;
    top: 50%;
    left: 10px;
    transform: translateY(-50%);
    color: #777;
  }

  /* TOP NAVIGATION */
  .dxbindia-topnav {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    justify-content: start;
    width: 100%;
    padding: 8px 0 ;
    background: var(--dxb-bg);
    margin-top: 6px;
  }

  .dxbindia-topnav > .dxbindia-dropdown {
    position: relative;
  }

  .dxbindia-topnav a {
    color: var(--dxb-text);
    text-decoration: none;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
  }

  .dxbindia-topnav a:hover {
    background: var(--dxb-hover);
    color: #0078d4;
  }

  /* CUSTOM DROPDOWN MENU */
  .dxbindia-dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: var(--dxb-bg);
    border: 1px solid var(--dxb-border);
    border-radius: 10px;
    min-width: 180px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    z-index: 1100;
  }

  .dxbindia-dropdown-menu a {
    display: block;
    padding: 8px 15px;
    color: var(--dxb-text);
    text-decoration: none;
    border-radius: 0;
  }

  .dxbindia-dropdown-menu a:hover {
    background: var(--dxb-hover);
    color: #0078d4;
  }

  .dxbindia-dropdown.show .dxbindia-dropdown-menu {
    display: block;
  }

  /* SIDEBAR */
  .dxbindia-sidebar {
    position: fixed;
    top: 0;
    left: -280px;
    width: 260px;
    height: 100%;
    background: var(--dxb-bg);
    border-right: 1px solid var(--dxb-border);
    transition: left 0.3s ease;
    padding: 20px;
    z-index: 1200;
    overflow-y: auto;
  }

  .dxbindia-sidebar.active {
    left: 0;
  }

  .dxbindia-sidebar .nav-link {
    display: flex;
    align-items: center;
    padding: 10px;
    color: var(--dxb-text);
    border-radius: 8px;
  }

  .dxbindia-sidebar .submenu {
    padding-left: 30px;
  }

  .dxbindia-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    display: none;
    z-index: 1150;
  }

  .dxbindia-overlay.active {
    display: block;
  }

  /* Dark Mode Toggle */
  .dxbindia-toggle {
    border: 1px solid var(--dxb-border);
    border-radius: 20px;
    padding: 4px 12px;
    cursor: pointer;
    background: transparent;
    color: var(--dxb-text);
  }
.language-button-wrapper {
        position: relative;
        display: inline-block;
        background-color: #ddd;
        color: #000;
        padding: 6px 15px 2px;
        border-radius: 5px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        overflow: hidden;
        margin:10px;
    }
    #google_translate_element {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
    }

     #google_translate_element_sticky{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
    }

    #google_translate_element select {
        width: 100%;
        height: 100%;
        cursor: pointer;
    }
     #google_translate_element_sticky select {
        width: 100%;
        height: 100%;
        cursor: pointer;
    } 
  .language-button-wrapper img {
    height: 16px;
    width: 16px;
    color:white !important;
   }


  /* Hide ANY Google Translate banner iframe */

  .goog-te-banner-frame.skiptranslate {
      display: none !important;
  } 

  body {
      top: 0px !important;  /* reset body position */
  }
  /* Style the dropdown container */
.goog-te-combo {
  background-color: #ddd !important;
  color: white !important;
  border: 1px solid #444 !important;
  padding: 16px 0px !important;
  border-radius: 6px;
  font-family: Arial, sans-serif;
  width: 100% !important;
  margin: 0px !important;
}

/* Optional: Style the dropdown arrow */
.goog-te-combo option {
  background-color: black;
  color: white;
}

.login-btn {
    padding: 6px 15px;
    background: #ed1c24;
    color: white !important;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
    box-shadow: 0 0 0 transparent;
    margin: 0px;
  }

  .login-btn:hover {
    background: #a50b10 !important;
    color: white !important;
    box-shadow: none !important;
  }

  /* Smooth Modal Animation */
#ModalSearch .modal-dialog {
  transform: translateY(-30px);
  transition: all 0.3s ease-in-out;
}
#ModalSearch.show .modal-dialog {
  transform: translateY(0);
}

/* Custom Input Styling */
#ModalSearch .form-control::placeholder {
  color: #999;
  font-style: italic;
}

/* Search Icon */
#ModalSearch .input-group-text i {
  font-size: 1.2rem;
}

/* Responsive */
@media (max-width: 576px) {
  #ModalSearch .modal-dialog {
    margin: 0 10px;
  }
  #ModalSearch .modal-body form {
    max-width: 100%;
  }
}
  @media (max-width: 768px) {
    .dxbindia-topnav {
      flex-wrap: nowrap;
      overflow-x: auto;
      white-space: nowrap;
      padding-bottom: 8px;
    }
    .dxbindia-topnav a {
      flex: 0 0 auto;
    }
  }
</style>

<header class="dxbindia-header">
  <!-- Left Menu Toggle -->
  <button id="menuBtn" class="btn btn-light mx-2">
    <i class="bi bi-list"></i>
  </button>

  <!-- Logo -->
  <div class="logo d-flex align-items-center">
    <a href="/" class="d-inline-block">
        <img src="{{ profile_setting.logo_dark.url }}" alt="Dark Logo" class="logo-light" style="max-height:60px;">
        <img src="{{ profile_setting.logo_light.url }}" alt="Light Logo" class="logo-dark" style="max-height:60px;">
      </a>
  </div>

  <!-- âœ… Right: Icons, Date, Language, Login/Logout -->
  <div class="col-lg-9 col-md-8 col-sm-12 d-flex justify-content-end align-items-center flex-wrap gap-3">
     
     <!-- Search Icon -->
            <a type="button" class="d-flex align-items-center" data-bs-toggle="modal"
              data-bs-target="#ModalSearch">
              <i class="bi bi-search text-dark" style="font-size: 18px;"></i>
            </a>
    <!-- Notification & Contact Icons -->
    <ul class="d-flex gap-3 align-items-center list-unstyled mb-0">
      <li><a href="{% url 'contact-us' %}" class="nav-icon"><i class="bi bi-person-fill fs-5"></i></a></li>
      <li>
        <a type="button" class="nav-icon" data-bs-toggle="modal" data-bs-target="#ModalSubscribe">
          <i class="bi bi-bell-fill fs-5"></i>
        </a>
      </li>
      {% include 'subscribe_model.html' %}
    </ul>

    <!-- Date -->
    <a href="#" class="d-flex align-items-center text-decoration-none">
      <i class="bi bi-calendar-date-fill me-2 fs-5"></i>
      <span class="calender-text" id="currentDate"></span>
    </a>

    <!-- Language Switch -->
    <div class="language-button-wrapper d-flex align-items-center">
      <i class="bi bi-translate fs-5 me-2"></i>
      <span>English</span>
      <i class="bi bi-chevron-down ms-1"></i>
      <div id="google_translate_element"></div>
    </div>

    <!-- Login / Logout -->
    {% if request.session.journalist_id %}
      <a href="{% url 'dashboard' %}" class="nav-link p-0">Dashboard</a>
      <a href="{% url 'logout-user' %}" class="nav-link p-0 text-danger fw-bold">Logout</a>
    {% else %}
      <a href="{% url 'sign-in' %}" class="btn btn-danger login-btn">
        Login
      </a>
    {% endif %}
  </div>

  

  <!-- Weather + Dark Mode -->
  <div class="d-flex align-items-center">
    <div class="me-3 text-secondary">ðŸŒž 27Â°C</div>
    <button id="darkToggle" class="dxbindia-toggle mx-2" ><i class="bi bi-moon"></i> Dark</button>
  </div>
<div class="container">
  <!-- TOP NAV -->
  <!-- âœ… DXBINDIA Dynamic Navigation -->
    <div class="dxbindia-topnav">

      {% for link in Blogcat %}
      <div class="dxbindia-dropdown">
        <a href="#" class="dxbindia-dropdown-toggle">
          {% trans link.cat_name %}
        </a>

        {% if link.sub_category_set.all %}
        <div class="dxbindia-dropdown-menu">
          {% for sublink in link.sub_category_set.all|dictsort:"subcat_status" %}
            {% if sublink.subcat_status == 'active' %}
            <a href="/{{ link.cat_slug }}/{{ sublink.subcat_slug }}">
              {% trans sublink.subcat_name %}
            </a>
            {% endif %}
          {% endfor %}
        </div>
        {% endif %}
      </div>
      {% endfor %}

    </div>
</div>
</header>

<!-- SIDEBAR -->
<div class="dxbindia-sidebar" id="sidebar">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center">
     <a href="/" class="d-inline-block">
        <img src="{{ profile_setting.logo_dark.url }}" alt="Dark Logo" class="logo-light" style="max-height:60px;">
        <img src="{{ profile_setting.logo_light.url }}" alt="Light Logo" class="logo-dark" style="max-height:60px;">
      </a>
    </div>
    <button class="btn btn-light btn-sm" id="closeSidebar"><i class="bi bi-x-lg"></i></button>
  </div>

    <!-- âœ… DXBINDIA SIDEBAR MENU -->
    <ul class="nav flex-column" id="dxbindiaSidebarMenu">

      {% for link in Blogcat %}
      <li class="">
        <a href="#"
          class="nav-link dropdown-toggle"
          data-bs-toggle="collapse"
          data-bs-target="#menu{{ forloop.counter }}"
          aria-expanded="false">
          {{ link.cat_name }}
        </a>

        {% if link.sub_category_set.all %}
        <ul class="submenu collapse" id="menu{{ forloop.counter }}" data-bs-parent="#dxbindiaSidebarMenu">
          {% for sublink in link.sub_category_set.all|dictsort:"subcat_status" %}
            {% if sublink.subcat_status == 'active' %}
            <li>
              <a href="/{{ link.cat_slug }}/{{ sublink.subcat_slug }}" class="nav-link">
                {{ sublink.subcat_name }}
              </a>
            </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% endif %}
      </li>
      {% endfor %}

    </ul>


</div>
<!-- ðŸ” Search Modal -->
<div class="modal fade" id="ModalSearch" tabindex="-1" aria-labelledby="ModalSearchLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-lg rounded-4">

      <!-- Header -->
      <div class="modal-header border-0 pb-0 px-4 pt-4">
        <h5 class="modal-title fw-semibold text-dark" id="ModalSearchLabel">Search</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          style="width: 40px; height: 40px; background-color: transparent; border: none;">
        </button>
      </div>

      <!-- Body -->
      <div class="modal-body px-4 pb-4 pt-3">

        <form action="{% url 'search' %}" method="get" class="mx-auto" style="max-width: 600px;">
          <div class="input-group input-group-lg border rounded-pill shadow-sm overflow-hidden">
            <span class="input-group-text bg-white border-0 ps-4">
              <i class="bi bi-search text-secondary"></i>
            </span>
            <input type="text" name="title" class="form-control border-0 shadow-none"
              placeholder="Search for posts, topics or categories..." required>
          </div>

          <button type="submit"
            class="btn w-100 mt-4 py-2 rounded-pill fw-semibold text-white"
            style="background-color: #ed1c24; border: none; font-size: 16px;">
            Search
          </button>
        </form>

      </div>
    </div>
  </div>
</div>

<div class="dxbindia-overlay" id="overlay"></div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<!-- Load Google Translate API -->
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<script>
  const menuBtn = document.getElementById("menuBtn");
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("overlay");
  const closeSidebar = document.getElementById("closeSidebar");
  const darkToggle = document.getElementById("darkToggle");

  // Sidebar toggle
  menuBtn.addEventListener("click", () => {
    sidebar.classList.add("active");
    overlay.classList.add("active");
  });

  closeSidebar.addEventListener("click", () => {
    sidebar.classList.remove("active");
    overlay.classList.remove("active");
  });

  overlay.addEventListener("click", () => {
    sidebar.classList.remove("active");
    overlay.classList.remove("active");
  });

  // Dark mode toggle
  darkToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    darkToggle.innerHTML = document.body.classList.contains("dark-mode")
      ? '<i class="bi bi-sun"></i> Light'
      : '<i class="bi bi-moon"></i> Dark';
  });

  // âœ… Main Menu Dropdown Logic (Click toggle with auto-close)
document.querySelectorAll('.dxbindia-dropdown-toggle').forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    const parent = btn.parentElement;

    // Close all other open dropdowns first
    document.querySelectorAll('.dxbindia-dropdown.show').forEach(drop => {
      if (drop !== parent) drop.classList.remove('show');
    });

    // Toggle current dropdown
    parent.classList.toggle('show');
  });
});

// Close dropdown if clicked outside
document.addEventListener('click', () => {
  document.querySelectorAll('.dxbindia-dropdown.show').forEach(drop => drop.classList.remove('show'));
});

document.querySelectorAll('.dxbindia-sidebar .dropdown-toggle').forEach(toggle => {
    toggle.addEventListener('click', function (e) {
      const target = document.querySelector(this.dataset.bsTarget);

      // Close all other open submenus
      document.querySelectorAll('.dxbindia-sidebar .submenu.show').forEach(menu => {
        if (menu !== target) {
          const collapse = bootstrap.Collapse.getInstance(menu);
          if (collapse) collapse.hide();
        }
      });
    });
  });
</script>
<script>
  function applyCustomTranslateStyles() {
  const combo = document.querySelector('.goog-te-combo');
  if (combo) {
    combo.style.backgroundColor = 'black';
    combo.style.color = 'white';
    combo.style.border = '1px solid #444';
    combo.style.padding = '16px';
    combo.style.borderRadius = '6px';
  }
}

// Wait for the widget to load
setTimeout(applyCustomTranslateStyles, 1000);
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'en,hi,pa',
      layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL,
      autoDisplay: false
    }, 'google_translate_element');
  }

  function hideTranslateBanner() {
    const elements = document.querySelectorAll(".VIpgJd-ZVi9od-ORHb-OEVmcd.skiptranslate");
    elements.forEach(el => {
      el.style.display = "none";
    });
  }

  // Run once on load
  hideTranslateBanner();

  // Watch for future changes (Google injects banner after load)
  const observer = new MutationObserver(hideTranslateBanner);
  observer.observe(document.body, { childList: true, subtree: true });
</script>